# <p style="text-align: center;">Προγραμματισμός Συστήματος</p>
## <p style="text-align: center;">1η Εργασία, Εαρινό Εξάμηνο 2023</p>
### Γιώργος-Λεωνίδας Μακρυγιάννης, 1900105

### Περιεχόμενα :
- **main.c** που περιέχει την main λούπα, τους signal handlers καθώς και τις κύριες συναρτήσεις για τα redirections & pipes.
- **handlersAndHelpers.c** που περιέχει όλες τις βοηθητικές συναρτήσεις και τους handlers για το σωστό parsing και κατακερματισμό
των εντολών που δίνονται στο shell.
- **handlersAndHelpers.h** που είναι το αρχείο επικεφαλίδας του handlersAndHelpers.c.

### Μεταγλώττιση-Εκτέλεση-Τερματισμός:
- Για την μεταγλώττιση γίνεται χρήση Makefile
- Ο Χρήστης κάνει make και έπειτα εκτελεί ./myexe για να τρέξει το shell.
- Για τον τερματισμό του shell ο χρήστης δίνει το command *exit*(built-in command).

### Parsing-Δομές:
- Για το σωστό parsing του command που θα δοθεί απο τον χρήστη και το σωστό spacing ανάμεσα
στα keywords(&,>,< etc.) χρησιμοποιείται η συνάρτηση **tokenizer**.
- Για κάθε εκτελέσιμο πρόγραμμα δημιουργείται ένα αντικείμενο τύπου **argumentStruct** όπου σε αυτό
αποθηκεύονται το όνομα και τα arguments του εκάστοτε εκτελέσιμου καθώς και διάφορες πληροφορίες όπως booleans που
υποδεικνύουν την ύπαρξη ή όχι redirection καθώς και αν το εκτελέσιμο θα είναι στο background/foreground.
- Τα aliases αποθηκεύονται σε ενα πίνακα που περιέχει αντικείμενα τύπου **alias** που αποθηκεύουν το όνομα του alias
καθώς και το command που πρέπει να εκτελείται σε περίπτωση που ο χρήστης δώσει στη γραμμή εντολής το
alias.

### Main/BuiltIn :
- Σε κάθε command έλεγχος αν υπάρχουν ;.Χωρισμός των εκτελέσιμων εντολών.
- Σε κάθε επανάληψη ελέγχεται αν το tokenized command είναι alias ή built in Command.
- Έχει υλοποιηθεί το cd σαν built in command και το exit σαν command εξόδου απο το shell.

### Redirections And Pipes:
- Σε κάθε command που δίνει ο χρήστης απο το πληκτρολόγιο κατα τη διάρκεια του parsing σημειώνεται αν υπάρχουν ή όχι pipes.
Σε περίπτωση που υπάρχουν pipes χρησιμοποιείται η συνάρτηση **pipeHandler** ενώ αν δεν υπάρχουν χρησιμποιείται η συνάρτηση
**redirectionHandler**.

#### PipeHandler : 
- Δημιουργεί array απο **argumentStruct** αντικείμενα για όλα τα εκτελέσιμα του pipeline.
- Γίνεται μια for για όλα τα εκτελέσιμα. Σε κάθε επανάληψη δημιουργείται ένα pipe το οποίο θα είναι υπεύθυνο για την
επικοινωνία στο τωρινό και στο επόμενο εκτελέσιμο πρόγραμμα. 
- - Σε κάθε εκτελέσιμο εκτός του τελευταίου το stdout ανακατευθύνεται
στο p[1] του pipe ώστε το εκάστοτε επόμενο εκτελέσιμο να μπορεί να διαβάσει την έξοδο του προηγούμενου του απο το p[0].
Στο τελευταίο εκτελέσιμο γίνεται και έλεγχος για το αν υπάρχει redirection σε κάποιο file.
- - Σε κάθε εκτελέσιμο εκτός του πρώτου το stdin ανακατευθύνεται στο p[0] του προηγούμενου pipe.Στο πρώτο εκτελέσιμο ελέγχεται
αν παίρνει ανακατεύθυνση απο κάποιο file. 
- Γίνεται έλεγχος για το αν το pipeline πρέπει να εκτελεστεί στο bg / fg.Σε περίπτωση που εκτελεστεί στο 
fg γίνεται wait για όλα τα εκτελέσιμα του pipeline, αλλιώς αναλαμβάνει ο SIGCHLD handler.
- Σε περίπτωση που το pipeline πρέπει να εκτελεστεί στο background τότε οι διεργασίες μπαίνουν σε νεό process group με αρχηγό
την πρώτη διεργασία.Αν το pipeline εκτελεστεί στο foreground τότε τα pids των fork σημειώνονται
σε περίπτωση που δοθεί κάποιο signal.

#### RedirectionHandler :
- Δημιουργείται αντικείμενο τύπου **argumentStruct**.
- Γίνεται fork και στο παιδί γίνονται οι απαραίτητοι έλεγχοι και ανακατευθύνσεις.
- Αμα το εκτελέσιμο πρέπει να εκτελεστεί στο background τότε αλλάζει pg.
- Στο πατέρα γίνεται έλεγχος αν πρέπει να γίνει wait ή οχι.
- Έπειτα γίνεται free στο malloced αντικείμενο.

### Background Execution :
- Για το background execution έχουν υλοποιηθεί global μεταβλητές childRunning που γίνεται ένα μόνο αν η διεργασία
είναι στο foreground καθώς και η μεταβλητή fgChildren που δείχνει πόσες διεργασίες πρέπει να επηρεαστούν σε περίπτωση κάποιου 
signal καθώς και ένας πίνακας που περιέχει όλα αυτά τα pid. Αυτές οι μεταβλητές είναι χρήσιμες για τον χειρισμό των σημάτων
καθώς και τον διαχωρισμό ανάμεσα σε fg & bg processes.

### Wild characters :
- Κάθε argument του εκάστοτε εκτελέσιμου ελέγχεται μήπως περιέχει κάποιο wild character με τη βοήθεια την **has_wildcard_char**.
Σε περίπτωση που περιέχει τότε το argument στέλνεται στη συνάρτηση **globHandler** η οποία με τη βοήθεια της βιβλιοθήκης 
glob κάνει populate σωστά τα arguments του εκτελέσιμου ανάλογα με το wild character που εντοπίσει.

### Aliases : 
- Δημιουργείται πίνακας μεγέθους MAX_ALIASES με αντικείμενα τύπου **alias**.
- Σε περίπτωση που δοθεί η built-in εντολή createalias τότε καλείται η συνάρτηση **createAliasHandler** όπου εκχωρείται 
το όνομα και το command ανάμεσα στα "".
- Σε περίπτωση που δοθεί η built-in εντολή destroyalias τότε καλείται η συνάρτηση **destroyAliasHandler** όπου βρίσκει στον 
πίνακα το alias και το αφαιρεί.
- Σε κάθε επανάληψη το πρόγραμμα ελέγχει αν το εκτελέσιμο είναι κάποιο alias και αν ναι τότε στέλνει στον tokenizer το command
που είναι αποθηκευμένο.

### Signals :
- Για τα signals έχουν εγκατασταθεί 3 sigaction και 3 sig-handlers για τα σήματα SIGCHLD,SIGINT,SIGTSTP.
- Η συνάρτηση handleSIGCHLD είναι υπεύθυνη για τα μαζεύει τα pid των bg processes.
- H συνάρτηση handleSIGINT είναι υπεύθυνη για να στέλνει SIGINT σήμα στα foreground processes.
- Η συνάρτηση handleSIGTSTP είναι υπεύθυνη για να στέλνει SIGTSTP εκτελέσιμα που είναι στο fg καθώς και 
αλλάζει το pgid των processes(τα βάζει στο background).

### MyHistory:
- Πίνακας που κρατάει τις τελευταίες 20 εκτελέσιμες εντολές που έχουν δοθεί απο τον χρήστη.
- Ο χρήστης δίνοντας την εντολή history <αριθμός> εκτελεί την εντολή που βρίσκεται στην συγκεκριμένη θέση του 
history.


### Πίνακας απο testing 
![image info](./testpicture1.png)

  
